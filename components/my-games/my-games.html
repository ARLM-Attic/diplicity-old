<link rel="import" href="/bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="/bower_components/more-routing/more-routing.html">
<link rel="import" href="/components/game-list/game-list.html">

<polymer-element name="my-games" attributes="subscriber user leaver joiner">
  <template>
	  <style>
			paper-tabs::shadow > * {
				height: 1.75em;
			}
			paper-tabs {
				height: 1.75em;
			}
	  </style>
		<more-route-selector>
  		<paper-tabs>
	  	  <paper-tab route="my-running-games">Running</paper-tab>
  		  <paper-tab route="my-forming-games">Forming</paper-tab>
  		  <paper-tab route="my-finished-games">Finished</paper-tab>
  		</paper-tabs>
		</more-route-selector>
		<more-route-selector>
    	<core-animated-pages transitions="cross-fade">
				<div route="my-running-games" cross-fade>
					<game-list user="{{ user }}" joiner="{{ joiner }}" leaver="{{ leaver }}" games="{{ runningGames }}"></game-list>
				</div>
				<div route="my-forming-games" cross-fade>
					<game-list user="{{ user }}" joiner="{{ joiner }}" leaver="{{ leaver }}" games="{{ formingGames }}"></game-list>
				</div>
				<div route="my-finished-games" cross-fade>
					<game-list user="{{ user }}" joiner="{{ joiner }}" leaver="{{ leaver}}" games="{{ finishedGames }}"></game-list>
				</div>
			</core-animated-pages>
		</more-route-selector>
	</template>
	<script>
		Polymer({
			filterGamesByState: function(games, state) {
				var result = _.filter(games, function(game) {
					return game.State == state;
				});
				return result;
			},
			gameStates: GameStates,
			computed: {
				runningGames: 'filterGamesByState(games, gameStates.Started)',
				formingGames: 'filterGamesByState(games, gameStates.Created)',
				finishedGames: 'filterGamesByState(games, gameStates.Ended)',
			},
			ready: function() {
				this.games = [];
				this.gamesSubscription = {
					get: function() {
						return this.games;
					}.bind(this),
					set: function(g) {
						this.games = g;
					}.bind(this),
				};
				this.subscriber.subscribe('/games/mine', this.gamesSubscription);
			},
			detached: function() {
				this.subscriber.unsubscribe('/games/mine', this.gamesSubscription);
			},
		});
	</script>
</polymer-element>



