<link rel="import" href="/bower_components/core-collapse/core-collapse.html">
<link rel="import" href="/bower_components/paper-button/paper-button.html">
<link rel="import" href="/bower_components/paper-shadow/paper-shadow.html">
<link rel="import" href="/components/game-list-element/game-list-element.html">

<polymer-element name="subscribing-game-list" attributes="subscriber path user">
  <template>
	  <template repeat="{{ game in games }}">
		  <game-list-element user="{{ user }}" game="{{ game }}"></game-list-element>
		</template>
	</template>
	<script>
		Polymer({
			toggleOpen: function() {
				this.opened = !this.opened;
			},
			ready: function() {
				this.games = [];
				this.message = function(msg) {
					switch (msg.Type) {
						case 'Fetch':
						this.games = msg.Object.Data;
						break;
						case 'Create':
						this.games.push(msg.Object.Data);
						break;
						case 'Update':
						this.games = _.reject(this.games, function(g) {
							return g.Id == msg.Object.Data.Id;
						}).push(msg.Object.Data);
						case 'Delete':
						this.games = _.reject(this.games, function(g) {
							return g.Id == msg.Object.Data.Id;
						})
					}
				}.bind(this);
				this.subscriber.subscribe(this.path, this.message);
			},
			detached: function() {
				this.subscriber.unsubscribe(this.path, this.message);
			},
		});
	</script>
</polymer-element>


